<!DOCTYPE html>
<html dir="ltr" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
        />
        <title>Stencil Component Starter</title>

        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100;300;400&family=Roboto:wght@100;300;400;500;700;900&display=swap"
            rel="stylesheet"
        />
        <script type="module" src="/build/astro-web-components.esm.js"></script>
        <script nomodule src="/build/astro-web-components.js"></script>

        <link rel="stylesheet" href="/build/astro-web-components.css" />
    </head>

    <body>
        <div style="width: 1050px; margin: auto">
            <rux-timeline
                timezone="America/New_York"
                start="2022-08-06T00:00"
                end="2022-08-11T00:00"
                interval="hour"
                zoom="2"
            >
                <rux-track id="region1">
                    <div slot="label">Region 1</div>
                </rux-track>

                <rux-track id="region2">
                    <div slot="label">Region 2</div>
                </rux-track>
                <rux-track slot="ruler">
                    <rux-ruler></rux-ruler>
                </rux-track>
            </rux-timeline>

            <section>
                <form id="form">
                    <rux-select name="region" label="Region" value="region1">
                        <rux-option
                            label="Region 1"
                            value="region1"
                        ></rux-option>
                        <rux-option
                            label="Region 2"
                            value="region2"
                        ></rux-option>
                        <rux-option
                            label="Region 3"
                            value="region3"
                        ></rux-option>
                    </rux-select>

                    <rux-input
                        name="start"
                        label="Event Start"
                        type="datetime-local"
                        value="2022-08-10T00:00"
                    ></rux-input>
                    <rux-input
                        name="end"
                        label="Event End"
                        value="2022-08-11T00:00"
                        type="datetime-local"
                    ></rux-input>

                    <rux-button type="submit">Add Event</rux-button>
                </form>
            </section>

            <script>
                const log = document.getElementById('log')
                const form = document.getElementById('form')
                const timelineEl = document.querySelector('rux-timeline')
                const onEventClick = (event) => {
                    console.log('event', event)
                    console.log('eventtarget', event.target)
                    showDialog(event.target)
                }

                form.addEventListener('submit', (e) => {
                    event.preventDefault()
                    // trigger formdata event
                    new FormData(form)
                })
                form.addEventListener('formdata', (e) => {
                    // Get the form data from the event object
                    let data = e.formData
                    const region = data.get('region')
                    const start = data.get('start')
                    const end = data.get('end')

                    const track = document.querySelector(
                        `rux-track[id="${region}"]`
                    )
                    const event = document.createElement('rux-time-region')
                    event.setAttribute('id', self.crypto.randomUUID())
                    event.addEventListener('click', onEventClick)
                    event.innerHTML = 'whatup'
                    event.setAttribute('start', start)
                    event.setAttribute('end', end)
                    track.appendChild(event)
                    track.setAttribute('name', name)
                })
            </script>

            <section
                style="
                    width: 66%;
                    padding: 1rem;
                    border: 2px solid var(--color-palette-grey-900);
                "
            >
                <style>
                    #timeline-range {
                        display: flex;
                        flex-direction: row;
                        justify-content: space-between;
                        align-items: center;
                        padding: 0.5rem;
                        border-radius: 0.5rem;
                    }
                </style>
                <form id="timeline-range" onsubmit="changeRange(event)">
                    <rux-input
                        label="Timeline Start"
                        id="timeline-start"
                        type="datetime-local"
                    ></rux-input>
                    <rux-input
                        label="Timeline End"
                        id="timeline-end"
                        type="datetime-local"
                    ></rux-input>
                    <rux-button type="submit">Submit</rux-button>
                </form>

                <rux-segmented-button id="range-presets"></rux-segmented-button>
                <script>
                    const rangePresets = document.getElementById(
                        'range-presets'
                    )
                    rangePresets.data = [
                        {
                            label: 'This week',
                        },
                        {
                            label: 'This month',
                        },
                        {
                            label: 'This day',
                        },
                    ]
                    rangePresets.addEventListener('ruxchange', (e) => {
                        const timelineEl = document.querySelector(
                            'rux-timeline'
                        )
                        if (e.target.selected === 'This week') {
                            timelineEl.start = '2022-03-01T00:00'
                            timelineEl.end = '2022-03-07T00:00'
                        } else if (e.target.selected === 'This month') {
                            timelineEl.start = '2022-03-01T00:00'
                            timelineEl.end = '2022-03-30T00:00'
                        } else if (e.target.selected === 'This day') {
                            timelineEl.start = '2022-03-01T00:00'
                            timelineEl.end = '2022-03-02T00:00'
                        }

                        console.log(e.target.selected)
                    })

                    globalThis.changeRange = (e) => {
                        e.preventDefault()
                        const start = document.getElementById('timeline-start')
                            .value
                        const end = document.getElementById('timeline-end')
                            .value
                        timelineEl.setAttribute('start', start)
                        timelineEl.setAttribute('end', end)
                    }
                </script>
            </section>

            <dialog id="favDialog">
                <div id="details"></div>
                <form method="dialog">
                    <rux-input
                        name="edit-event-start"
                        type="datetime-local"
                        id="editEventStart"
                        label="Event Start"
                    ></rux-input>
                    <rux-input
                        name="edit-event-end"
                        type="datetime-local"
                        id="editEventEnd"
                        label="Event End"
                    ></rux-input>
                    <div>
                        <button value="cancel">Cancel</button>
                        <button id="confirmBtn" value="default">Confirm</button>
                    </div>
                </form>
            </dialog>

            <script>
                const dialogEl = document.getElementById('favDialog')
                const showDialog = (e) => {
                    dialogEl.setAttribute('data-event', e.getAttribute('id'))
                    editEventStart.value = e.start
                    editEventEnd.value = e.end

                    dialogEl.showModal()
                }
                dialogEl.addEventListener('close', () => {
                    if (dialogEl.returnValue === 'default') {
                        const event = document.getElementById(
                            dialogEl.getAttribute('data-event')
                        )
                        event.start = editEventStart.value
                        event.end = editEventEnd.value
                    }
                })
            </script>
        </div>
    </body>
</html>
